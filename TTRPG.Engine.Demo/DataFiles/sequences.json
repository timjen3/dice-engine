[
    {
        "Name": "Attack",
        "Items": [
            {
                "Name": "Intention",
                "Equation": "{attacker_name} {wAction} at {defender_name}.",
                "ResultName": "intention",
                "SequenceItemEquationType": "Message"
            },
            {
                "Name": "To Hit",
                "Equation": "random(1,1,20) + dex",
                "ResultName": "to_hit",
                "SequenceItemEquationType": "Algorithm"
            },
            {
                "Name": "Dodge",
                "Equation": "random(1,1,20) + dex",
                "ResultName": "dodge",
                "SequenceItemEquationType": "Algorithm"
            },
            {
                "Name": "Report Hit",
                "Equation": "The attack lands! ({to_hit} To Hit > {dodge} dodge)",
                "ResultName": "ToHitMsg",
                "SequenceItemEquationType": "Message"
            },
            {
                "Name": "Report Miss",
                "Equation": "Miss! ({to_hit} To Hit <= {dodge} Dodge)",
                "ResultName": "ToHitMsg",
                "SequenceItemEquationType": "Message"
            },
            {
                "Name": "Damage",
                "Equation": "max(random(wHits,wMin,wMax) - ac + floor(str / 4), 0)",
                "ResultName": "damage",
                "SequenceItemEquationType": "Algorithm"
            },
            {
                "Name": "Report Damage",
                "Equation": "{attacker_name} dealt {damage} damage to {defender_name} from {wHits} attacks.",
                "ResultName": "DamageMsg",
                "SequenceItemEquationType": "Message"
            },
            {
                "Name": "Take Damage",
                "Equation": "hp - damage",
                "ResultName": "new_hp",
                "SequenceItemEquationType": "Algorithm"
            },
            {
                "Name": "Report Damage Taken",
                "Equation": "{defender_name} HP : {old_hp} => {new_hp}",
                "ResultName": "DamageTakenMsg",
                "SequenceItemEquationType": "Message"
            }
        ],
        "Conditions": [
            {
                "DependentOnItem": null,
                "Equation": "hp > 0",
                "ItemNames": null,
                "ThrowOnFail": false,
                "FailureMessage": null
            },
            {
                "DependentOnItem": null,
                "Equation": "dodge >= to_hit",
                "ItemNames": [
                    "Report Miss"
                ],
                "ThrowOnFail": false,
                "FailureMessage": null
            },
            {
                "DependentOnItem": null,
                "Equation": "dodge < to_hit",
                "ItemNames": [
                    "Report Hit",
                    "Damage"
                ],
                "ThrowOnFail": false,
                "FailureMessage": null
            },
            {
                "DependentOnItem": "Damage",
                "Equation": null,
                "ItemNames": [
                    "Report Damage"
                ],
                "ThrowOnFail": false,
                "FailureMessage": null
            },
            {
                "DependentOnItem": "Damage",
                "Equation": "damage > 0",
                "ItemNames": [
                    "Take Damage",
                    "Report Damage Taken",
                    "Update Attribute"
                ],
                "ThrowOnFail": false,
                "FailureMessage": null
            }
        ],
        "Mappings": [
            {
                "From": "name",
                "To": "attacker_name",
                "ItemName": null,
                "RoleName": "attacker",
                "MappingType": "Role",
                "ThrowOnFailure": false
            },
            {
                "From": "name",
                "To": "defender_name",
                "ItemName": null,
                "RoleName": "defender",
                "MappingType": "Role",
                "ThrowOnFailure": false
            },
            {
                "From": "hp",
                "To": "hp",
                "ItemName": null,
                "RoleName": "defender",
                "MappingType": "Role",
                "ThrowOnFailure": false
            },
            {
                "From": "dex",
                "To": "dex",
                "ItemName": "To Hit",
                "RoleName": "attacker",
                "MappingType": "Role",
                "ThrowOnFailure": false
            },
            {
                "From": "dex",
                "To": "dex",
                "ItemName": "Dodge",
                "RoleName": "defender",
                "MappingType": "Role",
                "ThrowOnFailure": false
            },
            {
                "From": "hits",
                "To": "wHits",
                "ItemName": "Report Damage",
                "RoleName": "weapon",
                "MappingType": "Role",
                "ThrowOnFailure": false
            },
            {
                "From": "ac",
                "To": "ac",
                "ItemName": "Damage",
                "RoleName": "defender",
                "MappingType": "Role",
                "ThrowOnFailure": false
            },
            {
                "From": "str",
                "To": "str",
                "ItemName": "Damage",
                "RoleName": "attacker",
                "MappingType": "Role",
                "ThrowOnFailure": false
            },
            {
                "From": "hits",
                "To": "wHits",
                "ItemName": "Damage",
                "RoleName": "weapon",
                "MappingType": "Role",
                "ThrowOnFailure": false
            },
            {
                "From": "min",
                "To": "wMin",
                "ItemName": "Damage",
                "RoleName": "weapon",
                "MappingType": "Role",
                "ThrowOnFailure": false
            },
            {
                "From": "max",
                "To": "wMax",
                "ItemName": "Damage",
                "RoleName": "weapon",
                "MappingType": "Role",
                "ThrowOnFailure": false
            },
            {
                "From": "action",
                "To": "wAction",
                "ItemName": "Intention",
                "RoleName": "weapon",
                "MappingType": "Role",
                "ThrowOnFailure": false
            },
            {
                "From": "hp",
                "To": "old_hp",
                "ItemName": "Report Damage Taken",
                "RoleName": "defender",
                "MappingType": "Role",
                "ThrowOnFailure": false
            }
        ],
        "ResultItems": [
            {
                "Name": "HP",
                "Category": "UpdateAttribute",
                "Source": "new_hp",
                "RoleName":  "defender"
            }
        ]
    },
    {
        "Name": "UsePotion",
        "Items": [
            {
                "Name": "Calculate Heal Amount",
                "Equation": "min(max_hp - old_hp, random(1,3,12) + floor(con / 4))",
                "ResultName": "heal_amt",
                "SequenceItemEquationType": "Algorithm"
            },
            {
                "Name": "Apply Healing",
                "Equation": "heal_amt + old_hp",
                "ResultName": "new_hp",
                "SequenceItemEquationType": "Algorithm"
            },
            {
                "Name": "Deduct Potion",
                "Equation": "potions - 1",
                "ResultName": "new_potions",
                "SequenceItemEquationType": "Algorithm"
            },
            {
                "Name": "Heal",
                "Equation": "{target_name} used 1 potion ({potions} => {new_potions})",
                "ResultName": "PotionMsg",
                "SequenceItemEquationType": "Message"
            },
            {
                "Name": "Heal",
                "Equation": "{target_name} healed {heal_amt} HP. ({old_hp} => {new_hp})",
                "ResultName": "HealMsg",
                "SequenceItemEquationType": "Message"
            }
        ],
        "Conditions": [
            {
                "DependentOnItem": null,
                "Equation": "old_hp != max_hp",
                "ItemNames": null,
                "ThrowOnFail": false,
                "FailureMessage": null
            },
            {
                "DependentOnItem": null,
                "Equation": "potions > 0",
                "ItemNames": null,
                "ThrowOnFail": false,
                "FailureMessage": null
            }
        ],
        "Mappings": [
            {
                "From": "name",
                "To": "target_name",
                "ItemName": null,
                "RoleName": null,
                "MappingType": "Role",
                "ThrowOnFailure": false
            },
            {
                "From": "potions",
                "To": "potions",
                "ItemName": null,
                "RoleName": null,
                "MappingType": "Role",
                "ThrowOnFailure": false
            },
            {
                "From": "con",
                "To": "con",
                "ItemName": null,
                "RoleName": null,
                "MappingType": "Role",
                "ThrowOnFailure": false
            },
            {
                "From": "hp",
                "To": "old_hp",
                "ItemName": null,
                "RoleName": null,
                "MappingType": "Role",
                "ThrowOnFailure": false
            },
            {
                "From": "max_hp",
                "To": "max_hp",
                "ItemName": null,
                "RoleName": null,
                "MappingType": "Role",
                "ThrowOnFailure": false
            }
        ],
        "ResultItems": [
            {
                "Name": "Potions",
                "Category": "UpdateAttribute",
                "Source": "new_potions",
                "RoleName": null,
                "FirstRole": true
            },
            {
                "Name": "HP",
                "Category": "UpdateAttribute",
                "Source": "new_hp",
                "RoleName": null,
                "FirstRole": true
            }
        ]
    },
    {
        "Name": "CheckIsDead",
        "Conditions": [
            {
                "DependentOnItem": null,
                "Equation": "hp <= 0",
                "ItemNames": null,
                "ThrowOnFail": false,
                "FailureMessage": null
            }
        ],
        "Mappings": [
            {
                "From": "hp",
                "To": "hp",
                "ItemName": null,
                "RoleName": null,
                "MappingType": "Role",
                "ThrowOnFailure": true
            }
        ]
    }
]